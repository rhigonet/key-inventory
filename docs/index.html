<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Inventory</title>
    <style>
        body {
            font-family: sans-serif;
        }
        #keys-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .key-card {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 1rem;
            width: 300px;
        }
        #filters {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <h1>Key Inventory</h1>
    <div id="filters">
        <input type="text" id="search" placeholder="Search by alias, owner, or purpose...">
        <select id="environment-filter">
            <option value="">All Environments</option>
        </select>
    </div>
    <div id="keys-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const keysContainer = document.getElementById('keys-container');
            const searchInput = document.getElementById('search');
            const environmentFilter = document.getElementById('environment-filter');
            let keys = [];

            fetch('keys.json')
                .then(response => response.json())
                .then(data => {
                    keys = data;
                    populateEnvironments(keys);
                    renderKeys(keys);
                });

            function populateEnvironments(keys) {
                const environments = [...new Set(keys.map(key => key.environment))];
                environments.forEach(env => {
                    const option = document.createElement('option');
                    option.value = env;
                    option.textContent = env;
                    environmentFilter.appendChild(option);
                });
            }

            function renderKeys(keysToRender) {
                keysContainer.innerHTML = '';
                keysToRender.forEach(key => {
                    const keyCard = document.createElement('div');
                    keyCard.className = 'key-card';
                    keyCard.innerHTML = `
                        <h3>${key.alias}</h3>
                        <p><strong>Owner:</strong> ${key.owner}</p>
                        <p><strong>Environment:</strong> ${key.environment}</p>
                        <p><strong>Purpose:</strong> ${key.purpose}</p>
                        <p><strong>Created At:</strong> ${new Date(key.created_at).toLocaleDateString()}</p>
                        <p><strong>Rotation (days):</strong> ${key.rotation_interval_days}</p>
                        <p><strong>Location:</strong> ${key.location}</p>
                        <p><strong>PCI Scope:</strong> ${key.compliance.pci_scope}</p>
                        <p><strong>NIST Classification:</strong> ${key.compliance.nist_classification}</p>
                        <p><strong>Tags:</strong> ${key.tags.join(', ')}</p>
                    `;
                    keysContainer.appendChild(keyCard);
                });
            }

            function filterKeys() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedEnvironment = environmentFilter.value;

                const filteredKeys = keys.filter(key => {
                    const matchesSearch = 
                        key.alias.toLowerCase().includes(searchTerm) ||
                        key.owner.toLowerCase().includes(searchTerm) ||
                        key.purpose.toLowerCase().includes(searchTerm);
                    
                    const matchesEnvironment = selectedEnvironment ? key.environment === selectedEnvironment : true;

                    return matchesSearch && matchesEnvironment;
                });

                renderKeys(filteredKeys);
            }

            searchInput.addEventListener('input', filterKeys);
            environmentFilter.addEventListener('change', filterKeys);
        });
    </script>
</body>
</html>