<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Lifecycle Management</title>
    <style>
        :root {
            /* Modern CSS Custom Properties inspired by v0 design */
            --background: 249 250 251;
            --foreground: 15 23 42;
            --card: 255 255 255;
            --card-foreground: 15 23 42;
            --primary: 37 99 235;
            --primary-foreground: 255 255 255;
            --secondary: 241 245 249;
            --secondary-foreground: 15 23 42;
            --muted: 248 250 252;
            --muted-foreground: 100 116 139;
            --accent: 241 245 249;
            --accent-foreground: 15 23 42;
            --destructive: 239 68 68;
            --destructive-foreground: 255 255 255;
            --border: 226 232 240;
            --input: 226 232 240;
            --ring: 37 99 235;
            --success: 34 197 94;
            --warning: 245 158 11;
            --info: 59 130 246;
            --radius: 0.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: rgb(var(--background));
            color: rgb(var(--foreground));
            line-height: 1.5;
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            background: rgb(var(--card));
            border-bottom: 1px solid rgb(var(--border));
            padding: 1rem 1.5rem;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            background: rgb(var(--primary));
            border-radius: var(--radius);
            color: rgb(var(--primary-foreground));
            font-size: 1.25rem;
        }

        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: rgb(var(--foreground));
            margin-bottom: 0.125rem;
        }

        .header-title p {
            font-size: 0.875rem;
            color: rgb(var(--muted-foreground));
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: rgb(var(--muted-foreground));
        }

        .status-indicator {
            width: 0.5rem;
            height: 0.5rem;
            background: rgb(var(--success));
            border-radius: 50%;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            text-decoration: none;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
        }

        .btn-primary {
            background: rgb(var(--primary));
            color: rgb(var(--primary-foreground));
        }

        .btn-primary:hover {
            background: rgb(30 58 138);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgb(var(--secondary));
            color: rgb(var(--secondary-foreground));
            border: 1px solid rgb(var(--border));
        }

        .btn-secondary:hover {
            background: rgb(var(--accent));
        }

        .btn-outline {
            background: transparent;
            color: rgb(var(--foreground));
            border: 1px solid rgb(var(--border));
        }

        .btn-outline:hover {
            background: rgb(var(--accent));
        }

        .btn-ghost {
            background: transparent;
            color: rgb(var(--foreground));
        }

        .btn-ghost:hover {
            background: rgb(var(--accent));
        }

        .btn-destructive {
            background: rgb(var(--destructive));
            color: rgb(var(--destructive-foreground));
        }

        .btn-destructive:hover {
            background: rgb(220 38 38);
        }

        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
        }

        /* Navigation Tabs */
        .nav-container {
            background: rgb(var(--card));
            border-bottom: 1px solid rgb(var(--border));
            padding: 0 1.5rem;
        }

        .nav-tabs {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
        }

        .nav-tab {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: rgb(var(--muted-foreground));
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            color: rgb(var(--foreground));
            background: rgb(var(--muted));
        }

        .nav-tab.active {
            color: rgb(var(--primary));
            border-bottom-color: rgb(var(--primary));
            background: rgb(239 246 255);
        }

        .nav-icon {
            width: 1rem;
            height: 1rem;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Card Styles */
        .card {
            background: rgb(var(--card));
            border: 1px solid rgb(var(--border));
            border-radius: var(--radius);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .card-header {
            padding: 1.5rem 1.5rem 0;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .card-description {
            font-size: 0.875rem;
            color: rgb(var(--muted-foreground));
        }

        .card-content {
            padding: 1.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: rgb(var(--card));
            border: 1px solid rgb(var(--border));
            border-radius: var(--radius);
            padding: 1.5rem;
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .stat-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: rgb(var(--muted-foreground));
        }

        .stat-icon {
            width: 1rem;
            height: 1rem;
            color: rgb(var(--muted-foreground));
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-description {
            font-size: 0.75rem;
            color: rgb(var(--muted-foreground));
        }

        /* Badge Styles */
        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.25rem 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-default {
            background: rgb(var(--secondary));
            color: rgb(var(--secondary-foreground));
        }

        .badge-outline {
            border: 1px solid rgb(var(--border));
            background: transparent;
        }

        .badge-destructive {
            background: rgb(252 165 165);
            color: rgb(185 28 28);
        }

        .badge-warning {
            background: rgb(254 243 199);
            color: rgb(180 83 9);
        }

        .badge-success {
            background: rgb(187 247 208);
            color: rgb(21 128 61);
        }

        /* Progress Bar */
        .progress {
            background: rgb(var(--secondary));
            border-radius: 9999px;
            height: 0.5rem;
            overflow: hidden;
        }

        .progress-bar {
            background: rgb(var(--primary));
            height: 100%;
            transition: width 0.3s ease;
        }

        /* Table Styles */
        .table-container {
            border: 1px solid rgb(var(--border));
            border-radius: var(--radius);
            overflow: hidden;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid rgb(var(--border));
        }

        .table th {
            background: rgb(var(--muted));
            font-weight: 500;
            font-size: 0.875rem;
            color: rgb(var(--muted-foreground));
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover {
            background: rgb(var(--muted));
        }

        /* Input Styles */
        .input {
            display: flex;
            width: 100%;
            border-radius: var(--radius);
            border: 1px solid rgb(var(--input));
            background: rgb(var(--background));
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: rgb(var(--ring));
            box-shadow: 0 0 0 3px rgba(var(--ring), 0.1);
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon input {
            padding-left: 2.5rem;
        }

        .input-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgb(var(--muted-foreground));
            width: 1rem;
            height: 1rem;
        }

        /* Select Styles */
        .select {
            display: flex;
            width: 100%;
            border-radius: var(--radius);
            border: 1px solid rgb(var(--input));
            background: rgb(var(--background));
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            cursor: pointer;
        }

        .select:focus {
            outline: none;
            border-color: rgb(var(--ring));
        }

        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, minmax(0, 1fr));
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .nav-tabs {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-tab {
                padding: 0.75rem 1rem;
                font-size: 0.75rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .grid-cols-2,
            .grid-cols-3,
            .grid-cols-4 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 640px) {
            .nav-tabs {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .p-4 {
            padding: 1rem;
        }

        .hidden {
            display: none;
        }

        /* Custom additions for key management */
        .key-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .key-card {
            background: rgb(var(--card));
            border: 1px solid rgb(var(--border));
            border-radius: var(--radius);
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .key-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .key-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .key-alias {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .key-id {
            font-size: 0.75rem;
            color: rgb(var(--muted-foreground));
            font-family: 'Monaco', 'Menlo', monospace;
            background: rgb(var(--muted));
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            word-break: break-all;
        }

        .key-details {
            display: grid;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            display: flex;
            gap: 0.5rem;
        }

        .detail-label {
            font-weight: 500;
            color: rgb(var(--muted-foreground));
            min-width: 80px;
            font-size: 0.875rem;
        }

        .detail-value {
            color: rgb(var(--foreground));
            font-size: 0.875rem;
            flex: 1;
        }

        .compliance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin: 0.75rem 0;
        }

        .compliance-item {
            padding: 0.5rem;
            background: rgb(var(--muted));
            border-radius: 0.375rem;
            font-size: 0.75rem;
            text-align: center;
            font-weight: 500;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.75rem 0;
        }

        .tag {
            background: rgb(var(--primary));
            color: rgb(var(--primary-foreground));
            padding: 0.25rem 0.5rem;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .key-actions {
            display: flex;
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgb(var(--border));
        }

        .rotation-warning {
            color: rgb(var(--warning));
            font-weight: 600;
        }

        .rotation-ok {
            color: rgb(var(--success));
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: rgb(var(--muted-foreground));
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* Activity feed styles */
        .activity-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgb(var(--border));
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-indicator {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            margin-top: 0.5rem;
            flex-shrink: 0;
        }

        .activity-indicator.success {
            background: rgb(var(--success));
        }

        .activity-indicator.warning {
            background: rgb(var(--warning));
        }

        .activity-indicator.error {
            background: rgb(var(--destructive));
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.125rem;
        }

        .activity-description {
            font-size: 0.75rem;
            color: rgb(var(--muted-foreground));
        }

        .activity-meta {
            text-align: right;
            font-size: 0.75rem;
            color: rgb(var(--muted-foreground));
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-brand">
                <div class="header-icon">🔐</div>
                <div class="header-title">
                    <h1>Key Lifecycle Management</h1>
                    <p>Comprehensive cryptographic key management system</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="system-status">
                    <div class="status-indicator"></div>
                    <span>System Healthy</span>
                </div>
                <button class="btn btn-primary">
                    <span>➕</span>
                    New Key Request
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-container">
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                <span class="nav-icon">📊</span>
                Dashboard
            </button>
            <button class="nav-tab" data-tab="keys">
                <span class="nav-icon">🔑</span>
                Key Management
            </button>
            <button class="nav-tab" data-tab="compliance">
                <span class="nav-icon">🛡️</span>
                Compliance
            </button>
            <button class="nav-tab" data-tab="monitoring">
                <span class="nav-icon">⚠️</span>
                Monitoring
            </button>
            <button class="nav-tab" data-tab="audit">
                <span class="nav-icon">📄</span>
                Audit Trail
            </button>
            <button class="nav-tab" data-tab="emergency">
                <span class="nav-icon">🚨</span>
                Emergency
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active space-y-6">
            <!-- Key Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Total Keys</span>
                        <span class="stat-icon">🔑</span>
                    </div>
                    <div class="stat-value" id="total-keys-stat">0</div>
                    <div class="stat-description">
                        <span style="color: rgb(var(--success));">+12</span> from last month
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Active Keys</span>
                        <span class="stat-icon">✅</span>
                    </div>
                    <div class="stat-value" style="color: rgb(var(--success));" id="active-keys-stat">0</div>
                    <div class="stat-description" id="active-keys-percentage">0% of total</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Need Rotation</span>
                        <span class="stat-icon">🕒</span>
                    </div>
                    <div class="stat-value" style="color: rgb(var(--warning));" id="rotation-keys-stat">0</div>
                    <div class="stat-description">Require attention within 7 days</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-title">Compliance Score</span>
                        <span class="stat-icon">🛡️</span>
                    </div>
                    <div class="stat-value" style="color: rgb(var(--info));" id="compliance-score-stat">0%</div>
                    <div class="progress mt-2">
                        <div class="progress-bar" id="compliance-progress" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Environment Distribution and Compliance Overview -->
            <div class="grid grid-cols-2">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Environment Distribution</h3>
                        <p class="card-description">Keys distributed across environments</p>
                    </div>
                    <div class="card-content">
                        <div class="space-y-4" id="environment-distribution">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Compliance Overview</h3>
                        <p class="card-description">Compliance status across frameworks</p>
                    </div>
                    <div class="card-content">
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm">PCI DSS</span>
                                <div class="flex items-center gap-2">
                                    <div class="progress" style="width: 5rem;">
                                        <div class="progress-bar" style="width: 96%"></div>
                                    </div>
                                    <span class="text-sm font-medium">96%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">SOX</span>
                                <div class="flex items-center gap-2">
                                    <div class="progress" style="width: 5rem;">
                                        <div class="progress-bar" style="width: 94%"></div>
                                    </div>
                                    <span class="text-sm font-medium">94%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">GDPR</span>
                                <div class="flex items-center gap-2">
                                    <div class="progress" style="width: 5rem;">
                                        <div class="progress-bar" style="width: 92%"></div>
                                    </div>
                                    <span class="text-sm font-medium">92%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">NIST</span>
                                <div class="flex items-center gap-2">
                                    <div class="progress" style="width: 5rem;">
                                        <div class="progress-bar" style="width: 98%"></div>
                                    </div>
                                    <span class="text-sm font-medium">98%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activities and Upcoming Rotations -->
            <div class="grid grid-cols-2">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activities</h3>
                        <p class="card-description">Latest key management operations</p>
                    </div>
                    <div class="card-content">
                        <div id="recent-activities">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Upcoming Rotations</h3>
                        <p class="card-description">Keys scheduled for rotation</p>
                    </div>
                    <div class="card-content">
                        <div id="upcoming-rotations">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Quick Actions</h3>
                    <p class="card-description">Common key management operations</p>
                </div>
                <div class="card-content">
                    <div class="grid grid-cols-4 gap-4">
                        <button class="btn btn-outline" style="height: 5rem; flex-direction: column;">
                            <span style="font-size: 1.5rem;">🔑</span>
                            <span class="text-sm">Create Key</span>
                        </button>
                        <button class="btn btn-outline" style="height: 5rem; flex-direction: column;">
                            <span style="font-size: 1.5rem;">🔄</span>
                            <span class="text-sm">Rotate Keys</span>
                        </button>
                        <button class="btn btn-outline" style="height: 5rem; flex-direction: column;">
                            <span style="font-size: 1.5rem;">📊</span>
                            <span class="text-sm">Compliance Report</span>
                        </button>
                        <button class="btn btn-outline" style="height: 5rem; flex-direction: column;">
                            <span style="font-size: 1.5rem;">🚨</span>
                            <span class="text-sm">Emergency Response</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Management Tab -->
        <div id="keys" class="tab-content space-y-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Key Inventory</h3>
                    <p class="card-description">Manage and monitor your cryptographic keys</p>
                </div>
                <div class="card-content">
                    <!-- Search and Filters -->
                    <div class="flex gap-4 mb-6">
                        <div class="flex-1">
                            <div class="input-with-icon">
                                <span class="input-icon">🔍</span>
                                <input type="text" id="search" class="input" placeholder="Search keys by alias, owner, purpose, or tags...">
                            </div>
                        </div>
                        <select id="environment-filter" class="select" style="min-width: 12rem;">
                            <option value="">All Environments</option>
                        </select>
                        <select id="compliance-filter" class="select" style="min-width: 12rem;">
                            <option value="">All Compliance</option>
                        </select>
                        <div class="flex items-center gap-4 text-sm" style="color: rgb(var(--muted-foreground));">
                            <div class="flex items-center gap-2">
                                <span>Total:</span>
                                <span class="font-semibold" style="color: rgb(var(--primary));" id="total-keys">0</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span>Showing:</span>
                                <span class="font-semibold" style="color: rgb(var(--primary));" id="visible-keys">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Keys Grid -->
                    <div id="keys-container" class="key-grid"></div>
                </div>
            </div>
        </div>

        <!-- Compliance Tab -->
        <div id="compliance" class="tab-content space-y-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Compliance Tracking</h3>
                    <p class="card-description">Monitor compliance across different frameworks</p>
                </div>
                <div class="card-content">
                    <div class="text-center p-4">
                        <h3 class="text-lg font-semibold mb-2">Compliance Dashboard</h3>
                        <p style="color: rgb(var(--muted-foreground));">Detailed compliance tracking and reporting features coming soon</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monitoring Tab -->
        <div id="monitoring" class="tab-content space-y-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Monitoring & Alerts</h3>
                    <p class="card-description">Real-time monitoring and alerting system</p>
                </div>
                <div class="card-content">
                    <div class="text-center p-4">
                        <h3 class="text-lg font-semibold mb-2">Monitoring Dashboard</h3>
                        <p style="color: rgb(var(--muted-foreground));">Advanced monitoring and alerting features coming soon</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audit Tab -->
        <div id="audit" class="tab-content space-y-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Audit Trail</h3>
                    <p class="card-description">Complete audit log of all key operations</p>
                </div>
                <div class="card-content">
                    <div class="text-center p-4">
                        <h3 class="text-lg font-semibold mb-2">Audit Trail</h3>
                        <p style="color: rgb(var(--muted-foreground));">Comprehensive audit logging features coming soon</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Tab -->
        <div id="emergency" class="tab-content space-y-6">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Emergency Procedures</h3>
                    <p class="card-description">Emergency response and key compromise handling</p>
                </div>
                <div class="card-content">
                    <div class="text-center p-4">
                        <h3 class="text-lg font-semibold mb-2">Emergency Response</h3>
                        <p style="color: rgb(var(--muted-foreground));">Emergency procedures and incident response features coming soon</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let keys = [];
        let activeTab = 'dashboard';

        // DOM elements
        const keysContainer = document.getElementById('keys-container');
        const searchInput = document.getElementById('search');
        const environmentFilter = document.getElementById('environment-filter');
        const complianceFilter = document.getElementById('compliance-filter');
        const totalKeysElement = document.getElementById('total-keys');
        const visibleKeysElement = document.getElementById('visible-keys');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initTabs();
            loadKeysData();
        });

        // Tab management
        function initTabs() {
            const tabButtons = document.querySelectorAll('.nav-tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.dataset.tab;
                    
                    // Update active tab
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    button.classList.add('active');
                    document.getElementById(tabName).classList.add('active');
                    
                    activeTab = tabName;
                });
            });
        }

        // Load keys data
        function loadKeysData() {
            fetch('keys.json')
                .then(response => response.json())
                .then(data => {
                    // Handle both old format (array) and new format (object with metadata)
                    if (Array.isArray(data)) {
                        keys = data;
                    } else if (data.keys) {
                        keys = data.keys;
                        // Display metadata if available
                        if (data.metadata) {
                            console.log('Build metadata:', data.metadata);
                            displayBuildInfo(data.metadata);
                        }
                    } else {
                        keys = [];
                    }
                    
                    populateFilters(keys);
                    renderKeys(keys);
                    updateStats(keys);
                    updateDashboard(keys);
                })
                .catch(error => {
                    console.error('Error loading keys:', error);
                    keysContainer.innerHTML = '<div class="empty-state"><h3>Error loading keys</h3><p>Please check the console for details.</p></div>';
                });
        }

        // Populate filter dropdowns
        function populateFilters(keys) {
            const environments = [...new Set(keys.map(key => key.environment))].sort();
            const complianceTypes = [...new Set(keys.map(key => key.compliance.nist_classification))].sort();
            
            environments.forEach(env => {
                const option = document.createElement('option');
                option.value = env;
                option.textContent = env.charAt(0).toUpperCase() + env.slice(1);
                environmentFilter.appendChild(option);
            });
            
            complianceTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                complianceFilter.appendChild(option);
            });
            
            // Add additional filter options for enhanced schema
            const pciOption = document.createElement('option');
            pciOption.value = 'pci';
            pciOption.textContent = 'PCI Scope';
            complianceFilter.appendChild(pciOption);
            
            const soxOption = document.createElement('option');
            soxOption.value = 'sox';
            soxOption.textContent = 'SOX Applicable';
            complianceFilter.appendChild(soxOption);
            
            const gdprOption = document.createElement('option');
            gdprOption.value = 'gdpr';
            gdprOption.textContent = 'GDPR Applicable';
            complianceFilter.appendChild(gdprOption);
        }

        // Update dashboard statistics
        function updateDashboard(keys) {
            const totalKeys = keys.length;
            const activeKeys = keys.filter(key => getKeyStatus(key) === 'active').length;
            const rotationKeys = keys.filter(key => {
                const rotation = getRotationStatus(key.created_at, key.rotation_interval_days);
                return rotation.status === 'warning' || rotation.status === 'overdue';
            }).length;
            
            // Update stats
            document.getElementById('total-keys-stat').textContent = totalKeys;
            document.getElementById('active-keys-stat').textContent = activeKeys;
            document.getElementById('active-keys-percentage').textContent = 
                totalKeys > 0 ? `${((activeKeys / totalKeys) * 100).toFixed(1)}% of total` : '0% of total';
            document.getElementById('rotation-keys-stat').textContent = rotationKeys;
            
            const complianceScore = 94; // Mock compliance score
            document.getElementById('compliance-score-stat').textContent = `${complianceScore}%`;
            document.getElementById('compliance-progress').style.width = `${complianceScore}%`;

            // Update environment distribution
            updateEnvironmentDistribution(keys);
            
            // Update recent activities
            updateRecentActivities();
            
            // Update upcoming rotations
            updateUpcomingRotations(keys);
        }

        // Update environment distribution
        function updateEnvironmentDistribution(keys) {
            const envCounts = {};
            keys.forEach(key => {
                envCounts[key.environment] = (envCounts[key.environment] || 0) + 1;
            });

            const total = keys.length;
            const container = document.getElementById('environment-distribution');
            container.innerHTML = '';

            Object.entries(envCounts).forEach(([env, count]) => {
                const percentage = total > 0 ? (count / total * 100) : 0;
                const color = env === 'prod' ? 'rgb(var(--destructive))' : 
                              env === 'staging' ? 'rgb(var(--warning))' : 'rgb(var(--success))';
                
                const item = document.createElement('div');
                item.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <div style="width: 0.75rem; height: 0.75rem; background: ${color}; border-radius: 50%;"></div>
                            <span class="text-sm">${env.charAt(0).toUpperCase() + env.slice(1)}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-medium">${count} keys</span>
                            <span class="badge ${env === 'prod' ? 'badge-destructive' : env === 'staging' ? 'badge-warning' : 'badge-success'}">${env.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: ${percentage}%; background: ${color};"></div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // Update recent activities (mock data)
        function updateRecentActivities() {
            const activities = [
                { action: 'Key Rotated', key: 'payment-service-jwt-prod', user: 'john.doe', time: '2 hours ago', status: 'success' },
                { action: 'Key Created', key: 'auth-service-rsa-staging', user: 'jane.smith', time: '4 hours ago', status: 'success' },
                { action: 'Emergency Replacement', key: 'api-gateway-hmac-prod', user: 'security-team', time: '6 hours ago', status: 'error' },
                { action: 'Compliance Scan', key: 'database-encryption-prod', user: 'system', time: '8 hours ago', status: 'warning' },
                { action: 'Key Approved', key: 'webhook-signing-dev', user: 'admin.user', time: '1 day ago', status: 'success' }
            ];

            const container = document.getElementById('recent-activities');
            container.innerHTML = '';

            activities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="activity-indicator ${activity.status}"></div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.action}</div>
                        <div class="activity-description">${activity.key}</div>
                    </div>
                    <div class="activity-meta">
                        <div>${activity.user}</div>
                        <div>${activity.time}</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // Update upcoming rotations
        function updateUpcomingRotations(keys) {
            const upcomingRotations = keys
                .map(key => {
                    const rotation = getRotationStatus(key.created_at, key.rotation_interval_days);
                    return {
                        ...key,
                        daysLeft: Math.max(0, key.rotation_interval_days - Math.floor((new Date() - new Date(key.created_at)) / (1000 * 60 * 60 * 24))),
                        priority: rotation.status === 'overdue' ? 'high' : rotation.status === 'warning' ? 'medium' : 'low'
                    };
                })
                .filter(key => key.daysLeft <= 30)
                .sort((a, b) => a.daysLeft - b.daysLeft)
                .slice(0, 5);

            const container = document.getElementById('upcoming-rotations');
            container.innerHTML = '';

            if (upcomingRotations.length === 0) {
                container.innerHTML = '<div class="text-center text-sm" style="color: rgb(var(--muted-foreground)); padding: 2rem;">No upcoming rotations in the next 30 days</div>';
                return;
            }

            upcomingRotations.forEach(rotation => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="badge ${rotation.priority === 'high' ? 'badge-destructive' : rotation.priority === 'medium' ? 'badge-warning' : 'badge-default'}">${rotation.priority}</span>
                        <div>
                            <div class="activity-title">${rotation.alias}</div>
                            <div class="activity-description">${rotation.environment}</div>
                        </div>
                    </div>
                    <div class="activity-meta">
                        <div class="font-medium">${rotation.daysLeft} days</div>
                        <div>${new Date(Date.now() + rotation.daysLeft * 24 * 60 * 60 * 1000).toLocaleDateString()}</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // Get key status
        function getKeyStatus(key) {
            const rotation = getRotationStatus(key.created_at, key.rotation_interval_days);
            return rotation.status === 'overdue' || rotation.status === 'warning' ? 'needs-rotation' : 'active';
        }

        // Get rotation status
        function getRotationStatus(createdAt, rotationDays) {
            const created = new Date(createdAt);
            const now = new Date();
            const daysSinceCreation = Math.floor((now - created) / (1000 * 60 * 60 * 24));
            const daysUntilRotation = rotationDays - daysSinceCreation;
            
            if (daysUntilRotation <= 0) {
                return { status: 'overdue', message: `${Math.abs(daysUntilRotation)} days overdue`, class: 'rotation-warning' };
            } else if (daysUntilRotation <= 30) {
                return { status: 'warning', message: `${daysUntilRotation} days remaining`, class: 'rotation-warning' };
            } else {
                return { status: 'ok', message: `${daysUntilRotation} days remaining`, class: 'rotation-ok' };
            }
        }

        // Render keys in the grid
        function renderKeys(keysToRender) {
            if (keysToRender.length === 0) {
                keysContainer.innerHTML = '<div class="empty-state"><h3>No keys found</h3><p>Try adjusting your search criteria.</p></div>';
                return;
            }
            
            keysContainer.innerHTML = '';
            keysToRender.forEach(key => {
                const rotationStatus = getRotationStatus(key.created_at, key.rotation_interval_days);
                const status = getKeyStatus(key);
                
                const keyCard = document.createElement('div');
                keyCard.className = 'key-card';
                
                // Enhanced schema v2.0 fields display
                const lifecycleStatus = key.lifecycle ? key.lifecycle.status : 'unknown';
                const technicalType = key.technical ? key.technical.key_type : 'unknown';
                const riskLevel = key.metadata ? key.metadata.risk_assessment : 'unknown';
                const complianceStatus = key.audit ? key.audit.compliance_status : 'unknown';
                const schemaVersion = key.metadata ? key.metadata.version : '1.0';
                
                keyCard.innerHTML = `
                    <div class="key-header">
                        <div>
                            <div class="key-alias">${key.alias}</div>
                            <div class="key-id">${key.key_id}</div>
                            <div style="font-size: 0.7rem; color: rgb(var(--muted-foreground)); margin-top: 0.25rem;">
                                Schema v${schemaVersion} | ${technicalType.toUpperCase()} | Risk: ${riskLevel}
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; align-items: flex-end;">
                            <span class="badge ${key.environment === 'prod' ? 'badge-destructive' : key.environment === 'staging' ? 'badge-warning' : 'badge-success'}">${key.environment}</span>
                            <span class="badge ${lifecycleStatus === 'active' ? 'badge-success' : lifecycleStatus === 'deprecated' ? 'badge-warning' : 'badge-destructive'}" style="font-size: 0.65rem;">${lifecycleStatus}</span>
                        </div>
                    </div>
                    
                    <div class="key-details">
                        <div class="detail-item">
                            <span class="detail-label">Owner:</span>
                            <span class="detail-value">${key.owner}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Purpose:</span>
                            <span class="detail-value">${key.purpose}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Created:</span>
                            <span class="detail-value">${new Date(key.created_at).toLocaleDateString()}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Rotation:</span>
                            <span class="detail-value ${rotationStatus.class}">${rotationStatus.message}</span>
                        </div>
                        
                        ${key.technical ? `
                        <div class="detail-item">
                            <span class="detail-label">Technical:</span>
                            <span class="detail-value">${key.technical.key_type} (${key.technical.key_size || 'N/A'} bits) - ${key.technical.algorithm || 'Standard'}</span>
                        </div>
                        ` : ''}
                        
                        ${key.operational ? `
                        <div class="detail-item">
                            <span class="detail-label">Monitoring:</span>
                            <span class="detail-value">${key.operational.monitoring_enabled ? '✓ Enabled' : '✗ Disabled'} | Auto-rotation: ${key.operational.auto_rotation_enabled ? '✓' : '✗'}</span>
                        </div>
                        ` : ''}
                        
                        <div class="detail-item">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value" style="font-family: 'Monaco', monospace; font-size: 0.75rem; word-break: break-all;">${key.location}</span>
                        </div>
                        
                        <div class="compliance-grid">
                            <div class="compliance-item">
                                <div>PCI: ${key.compliance.pci_scope}</div>
                            </div>
                            <div class="compliance-item">
                                <div>NIST: ${key.compliance.nist_classification}</div>
                            </div>
                            ${key.compliance.sox_applicable ? '<div class="compliance-item"><div>SOX: ✓</div></div>' : ''}
                            ${key.compliance.gdpr_applicable ? '<div class="compliance-item"><div>GDPR: ✓</div></div>' : ''}
                        </div>
                        
                        ${key.relationships && key.relationships.used_by && key.relationships.used_by.length > 0 ? `
                        <div class="detail-item">
                            <span class="detail-label">Used by:</span>
                            <span class="detail-value">${key.relationships.used_by.slice(0, 3).join(', ')}${key.relationships.used_by.length > 3 ? '...' : ''}</span>
                        </div>
                        ` : ''}
                        
                        ${key.operational && key.operational.cost_center ? `
                        <div class="detail-item">
                            <span class="detail-label">Cost Center:</span>
                            <span class="detail-value">${key.operational.cost_center}</span>
                        </div>
                        ` : ''}
                        
                        <div class="tags">
                            ${key.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="key-actions">
                        <button class="btn btn-destructive btn-sm" onclick="showDeleteModal('${key.key_id}', '${key.alias}')">
                            🗑️ Delete
                        </button>
                        <a href="https://github.com/rhigonet/key-inventory/blob/main/inventory/${key.key_id}.yaml" target="_blank" class="btn btn-secondary btn-sm">
                            📝 View YAML
                        </a>
                        ${key.metadata && key.metadata.documentation_url ? `
                        <a href="${key.metadata.documentation_url}" target="_blank" class="btn btn-outline btn-sm">
                            📖 Docs
                        </a>
                        ` : ''}
                    </div>
                `;
                keysContainer.appendChild(keyCard);
            });
        }

        // Update statistics
        function updateStats(keys) {
            const total = keys.length;
            totalKeysElement.textContent = total;
            visibleKeysElement.textContent = total;
        }

        // Filter keys
        function filterKeys() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedEnvironment = environmentFilter.value;
            const selectedCompliance = complianceFilter.value;

            const filteredKeys = keys.filter(key => {
                const matchesSearch = 
                    key.alias.toLowerCase().includes(searchTerm) ||
                    key.owner.toLowerCase().includes(searchTerm) ||
                    key.purpose.toLowerCase().includes(searchTerm) ||
                    key.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                    (key.technical && key.technical.key_type && key.technical.key_type.toLowerCase().includes(searchTerm)) ||
                    (key.relationships && key.relationships.used_by && key.relationships.used_by.some(service => service.toLowerCase().includes(searchTerm)));
                
                const matchesEnvironment = selectedEnvironment ? key.environment === selectedEnvironment : true;
                
                let matchesCompliance = true;
                if (selectedCompliance) {
                    switch(selectedCompliance) {
                        case 'pci':
                            matchesCompliance = key.compliance.pci_scope !== 'none';
                            break;
                        case 'sox':
                            matchesCompliance = key.compliance.sox_applicable === true;
                            break;
                        case 'gdpr':
                            matchesCompliance = key.compliance.gdpr_applicable === true;
                            break;
                        default:
                            matchesCompliance = key.compliance.nist_classification === selectedCompliance;
                    }
                }

                return matchesSearch && matchesEnvironment && matchesCompliance;
            });

            renderKeys(filteredKeys);
            visibleKeysElement.textContent = filteredKeys.length;
        }

        // Display build info
        function displayBuildInfo(metadata) {
            const header = document.querySelector('.header-title');
            if (metadata && header) {
                const buildInfo = document.createElement('div');
                buildInfo.style.fontSize = '0.75rem';
                buildInfo.style.color = 'rgb(var(--muted-foreground))';
                buildInfo.style.marginTop = '0.25rem';
                
                let infoText = `Built: ${new Date(metadata.build_timestamp).toLocaleString()}`;
                if (metadata.schema_version) {
                    infoText += ` | Schema: v${metadata.schema_version}`;
                }
                if (metadata.statistics && metadata.statistics.schema_usage) {
                    const enhanced = metadata.statistics.schema_usage.enhanced_schema_v2 || 0;
                    const legacy = metadata.statistics.schema_usage.legacy_schema_v1 || 0;
                    infoText += ` | Enhanced: ${enhanced}, Legacy: ${legacy}`;
                }
                
                buildInfo.textContent = infoText;
                header.appendChild(buildInfo);
            }
        }

        // Placeholder for delete modal functionality
        function showDeleteModal(keyId, keyAlias) {
            alert(`Delete functionality for key ${keyAlias} (${keyId}) would be implemented here.`);
        }

        // Event listeners
        if (searchInput) searchInput.addEventListener('input', filterKeys);
        if (environmentFilter) environmentFilter.addEventListener('change', filterKeys);
        if (complianceFilter) complianceFilter.addEventListener('change', filterKeys);
    </script>
</body>
</html>